databases:
  - name: workflow-engine-db
    plan: free

services:
  - type: web
    name: workflow-engine
    env: docker
    plan: free
    dockerContext: .
    dockerfilePath: apps/server/Dockerfile

    # Render sets $PORT automatically for web services.
    envVars:
      - key: NODE_ENV
        value: production
      - key: PUBLIC_BASE_URL
        value: https://workflow-engine.onrender.com

      - key: DATABASE_URL
        fromDatabase:
          name: workflow-engine-db
          property: connectionString

      # Required
      - key: JWT_SECRET
        generateValue: true

      # Execution mode
      # Option A (recommended): use real AWS SQS (set credentials as secrets)
      # - WORKER_ENABLED=true starts an SQS worker (only if credentials are set)
      # - Triggers enqueue to SQS and wait for completion (single-instance waiter)
      - key: WORKER_ENABLED
        value: "true"
      - key: AWS_REGION
        value: us-east-1
      - key: AWS_ACCESS_KEY_ID
        sync: false
      - key: AWS_SECRET_ACCESS_KEY
        sync: false

      # Option B: no AWS credentials (no queue)
      # Leave AWS_ACCESS_KEY_ID / AWS_SECRET_ACCESS_KEY blank and triggers will
      # execute synchronously in the Node.js process.
